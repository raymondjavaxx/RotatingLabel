name: Build
on:
  push:
    branches: [ main ]
    paths:
      - '.github/workflows/build.yml'
      - RotatingLabelTests/**/*
      - '**/*.swift'
  pull_request:
    branches: [ main ]
    paths:
      - '.github/workflows/build.yml'
      - RotatingLabelTests/**/*
      - '**/*.swift'
jobs:
  build:
    runs-on: macos-12
    steps:
      - name: Prep
        run: defaults write com.apple.dt.XCBuild IgnoreFileSystemDeviceInodeChanges -bool YES
      - uses: actions/checkout@v3
      - uses: actions/cache@v3
        with:
          path: .build
          key: ${{ runner.os }}-v2-${{ hashFiles('**/Package.resolved') }}
          restore-keys: |
            ${{ runner.os }}-v2-
      - name: Build iOS
        run: make build_ios
      - name: Build tvOS
        run: make build_ios
      - name: Run tests
        run: make test
